<template>
  <div class="fruits-container flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
    <a-card class="w-full max-w-md p-6 bg-white rounded-lg shadow-md">
      <div class="flex items-center text-2xl space-x-2 font-bold text-center mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
          <g fill="none">
            <path fill="url(#f806ido)"
              d="m26.332 8.62l-2.95-2.95l-17.71 17.71l2.95 2.95c4.89 4.89 12.82 4.89 17.71 0c4.89-4.89 4.89-12.82 0-17.71Z" />
            <path fill="url(#f806id0)"
              d="m26.332 8.62l-2.95-2.95l-17.71 17.71l2.95 2.95c4.89 4.89 12.82 4.89 17.71 0c4.89-4.89 4.89-12.82 0-17.71Z" />
            <path fill="#ABD837"
              d="M14.532 27.06c6.92 0 12.53-5.61 12.53-12.53c0-6.92-5.61-12.53-12.53-12.53c-6.92 0-12.53 5.61-12.53 12.53c0 6.92 5.61 12.53 12.53 12.53Z" />
            <path fill="url(#f806id1)"
              d="M14.532 27.06c6.92 0 12.53-5.61 12.53-12.53c0-6.92-5.61-12.53-12.53-12.53c-6.92 0-12.53 5.61-12.53 12.53c0 6.92 5.61 12.53 12.53 12.53Z" />
            <path fill="url(#f806id2)"
              d="M14.532 27.06c6.92 0 12.53-5.61 12.53-12.53c0-6.92-5.61-12.53-12.53-12.53c-6.92 0-12.53 5.61-12.53 12.53c0 6.92 5.61 12.53 12.53 12.53Z" />
            <path fill="url(#f806id3)"
              d="M14.532 27.06c6.92 0 12.53-5.61 12.53-12.53c0-6.92-5.61-12.53-12.53-12.53c-6.92 0-12.53 5.61-12.53 12.53c0 6.92 5.61 12.53 12.53 12.53Z" />
            <path fill="#E5F892" d="M14.533 20.15a5.62 5.62 0 1 0 0-11.24a5.62 5.62 0 0 0 0 11.24Z" />
            <g filter="url(#f806ide)">
              <path fill="#7BAE29" d="M20.152 9.75a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idf)">
              <path fill="#7BAE29" d="M22.61 14.72a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idg)">
              <path fill="#7BAE29" d="M21.442 19.68a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idh)">
              <path fill="#7BAE29" d="M17.68 23.4a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idi)">
              <path fill="#7BAE29" d="M12.492 23.962a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idj)">
              <path fill="#7BAE29" d="M8.012 21.65a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idk)">
              <path fill="#7BAE29" d="M5.481 16.49a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <g filter="url(#f806idl)">
              <path fill="#7BAE29" d="M6.652 11.459a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <path fill="url(#f806id4)" d="M20.462 9.47a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806id5)" d="M8.492 21.44a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806idp)" d="M15.943 7.12a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <g filter="url(#f806idm)">
              <path fill="#7BAE29" d="M15.512 7.291a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <path fill="url(#f806id6)" d="M15.943 7.12a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806id7)" d="M13.002 23.79a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <g filter="url(#f806idn)">
              <path fill="#7BAE29" d="M10.452 8.069a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            </g>
            <path fill="url(#f806id8)" d="M10.902 7.79a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806id9)" d="M18.052 23.12a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806ida)" d="M7.152 11.22a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806idb)" d="M21.802 19.68a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806idc)" d="M6.052 16.19a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <path fill="url(#f806idd)" d="M22.902 14.72a.98.98 0 1 0 0-1.96a.98.98 0 0 0 0 1.96Z" />
            <defs>
              <radialGradient id="f806id0" cx="0" cy="0" r="1"
                gradientTransform="matrix(-4.06252 6.25 -15.10068 -9.8155 27.5 14.813)" gradientUnits="userSpaceOnUse">
                <stop stop-color="#D29280" />
                <stop offset="1" stop-color="#D2927F" stop-opacity="0" />
              </radialGradient>
              <radialGradient id="f806id1" cx="0" cy="0" r="1"
                gradientTransform="rotate(98.409 1.112 13.937) scale(14.5312)" gradientUnits="userSpaceOnUse">
                <stop stop-color="#AEDD38" stop-opacity="0" />
                <stop offset=".774" stop-color="#A7D335" stop-opacity=".316" />
                <stop offset=".863" stop-color="#98BD30" />
                <stop offset=".913" stop-color="#7FA91C" />
              </radialGradient>
              <radialGradient id="f806id2" cx="0" cy="0" r="1"
                gradientTransform="rotate(66.819 -4.17 17.64) scale(14.9249)" gradientUnits="userSpaceOnUse">
                <stop stop-color="#AEDE37" stop-opacity="0" />
                <stop offset=".823" stop-color="#D6F76C" stop-opacity="0" />
                <stop offset=".927" stop-color="#E4FF7E" />
              </radialGradient>
              <radialGradient id="f806id3" cx="0" cy="0" r="1" gradientTransform="rotate(90 .001 14.531) scale(15.595)"
                gradientUnits="userSpaceOnUse">
                <stop stop-color="#B4E637" />
                <stop offset="1" stop-color="#B1E138" stop-opacity="0" />
              </radialGradient>
              <radialGradient id="f806id4" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 9.626 6.193) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806id5" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 2.5 11.036) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806id6" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 7.59 4.587) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806id7" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 4.53 12.641) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806id8" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 5.007 4.44) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806id9" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 7.12 12.788) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806ida" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 2.804 5.798) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806idb" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 9.322 11.426) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806idc" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 1.78 8.178) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <radialGradient id="f806idd" cx="0" cy="0" r="1"
                gradientTransform="rotate(158.394 10.345 9.05) scale(1.69738)" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#7B6D83" />
                <stop offset=".368" stop-color="#533E60" />
                <stop offset=".714" stop-color="#584D5D" />
                <stop offset="1" stop-color="#1C1C1C" />
              </radialGradient>
              <filter id="f806ide" width="3.96" height="3.96" x="18.172" y="6.79" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idf" width="3.96" height="3.96" x="20.63" y="11.76" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idg" width="3.96" height="3.96" x="19.462" y="16.72" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idh" width="3.96" height="3.96" x="15.7" y="20.44" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idi" width="3.96" height="3.96" x="10.512" y="21.003" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idj" width="3.96" height="3.96" x="6.032" y="18.69" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idk" width="3.96" height="3.96" x="3.501" y="13.53" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idl" width="3.96" height="3.96" x="4.672" y="8.499" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idm" width="3.96" height="3.96" x="13.533" y="4.331" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <filter id="f806idn" width="3.96" height="3.96" x="8.472" y="5.109" color-interpolation-filters="sRGB"
                filterUnits="userSpaceOnUse">
                <feFlood flood-opacity="0" result="BackgroundImageFix" />
                <feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape" />
                <feGaussianBlur result="effect1_foregroundBlur_18_30155" stdDeviation=".5" />
              </filter>
              <linearGradient id="f806ido" x1="29.563" x2="14.875" y1="13.75" y2="31.563"
                gradientUnits="userSpaceOnUse">
                <stop stop-color="#A76051" />
                <stop offset=".469" stop-color="#9D5952" />
                <stop offset=".733" stop-color="#8B5863" />
                <stop offset="1" stop-color="#67405C" />
              </linearGradient>
              <linearGradient id="f806idp" x1="16.596" x2="15.206" y1="5.395" y2="6.786" gradientUnits="userSpaceOnUse">
                <stop offset=".006" stop-color="#513468" />
                <stop offset="1" stop-color="#1C1C1C" />
              </linearGradient>
            </defs>
          </g>
        </svg>
        <span>Fruits</span>
      </div>

      <div class="flex justify-between mb-2">
        <a-button type="primary" @click="load">Load Fruits</a-button>
        <a-button type="primary" @click="update" :disabled="selectedId === null" v-if="isUserRole">Update</a-button>
        <a-button @click="remove" v-if="isUserRole" type="primary" danger>Delete</a-button>
      </div>
      <a-input v-if="isUserRole" v-model:value="fruitName" placeholder="Fruit Name" class="my-2" />
      <a-input v-if="isUserRole" v-model:value="fruitColor" placeholder="Fruit Color" class="" />
     
      <div v-if="isUserRole" class="flex justify-between my-2">
        <a-button type="primary" @click="create" :disabled="!fruitName || !fruitColor">Add Fruit</a-button>
        <a-button @click="clearFields" :disabled="!fruitName && !fruitColor">Clear Fields</a-button>
      </div>
      <a-list class="mb-4" bordered :dataSource="fruits">
        <template #renderItem="{ item }">
          <a-list-item>
            <a-radio-group v-model:value="selectedId">
              <a-radio :value="item.id">{{ item.name }} : {{ item.color }}</a-radio>
            </a-radio-group>
          </a-list-item>
        </template>
      </a-list>

      <div class="mt-4">{{ debug }}</div>
    </a-card>
  </div>
</template>

<script lang="ts" setup>
import { ref, watch, onMounted } from 'vue';
import { message } from 'ant-design-vue';
import HttpService from '../services/HttpService';
import KeycloakService from '../services/KeycloakService';

const fruits = ref<{ id: number; name: string; color: string }[]>([]);
const selectedId = ref<number | null>(null);
const fruitName = ref('');
const fruitColor = ref('');
const debug = ref('');
const roles = KeycloakService.GetUserRoles();
const isUserRole = roles.includes('admin');

// Fetch all fruits
async function load() {
  try {
    const res = await HttpService.getAxiosClient().get(`/fruits`);
    fruits.value = res.data;
    message.success('Fruits loaded successfully');
  } catch (error) {
    message.error('Failed to load fruits');
  }
}

// Create a new fruit
async function create() {
  if (!fruitName.value || !fruitColor.value) {
    message.error('Please enter both fruit name and color');
    return;
  }

  try {
    const res = await HttpService.getAxiosClient().post(`/fruits`, {
      name: fruitName.value,
      color: fruitColor.value,
    });
    if (res.status === 201) {
      await load(); 
      clearFields(); // Clear input fields
      message.success('Fruit added successfully');
    } else {
      message.error('Failed to add fruit');
    }
  } catch (error) {
    message.error('Failed to add fruit');
  }
}

// Update a fruit
async function update() {
  if (selectedId.value === null) {
    message.error('Please select a fruit to update');
    return;
  }

  try {
    const response = await HttpService.getAxiosClient().patch(
      `/fruits/${selectedId.value}`,
      {
        name: fruitName.value,
        color: fruitColor.value,
      },
    );
    if (response.status === 200) {
      await load();
      clearFields();
      message.success('Fruit updated successfully');
    } else {
      message.error('Failed to update fruit');
    }
  } catch (error) {
    message.error('Failed to update fruit');
  }
}

// Remove a fruit
async function remove() {
  if (selectedId.value === null) {
    message.error('Please select a fruit to delete');
    return;
  }

  try {
    const res = await HttpService.getAxiosClient().delete(`/fruits/${selectedId.value}`);
    if (res.status === 200) {
      await load(); // Reload fruits list
      selectedId.value = null;
      message.success('Fruit removed successfully');
    } else {
      message.error('Failed to remove fruit');
    }
  } catch (error) {
    message.error('Failed to remove fruit');
  }
}

// Clear input fields
function clearFields() {
  fruitName.value = '';
  fruitColor.value = '';
  selectedId.value = null;
}

watch(selectedId, (newId) => {
  if (newId !== null) {
    const selectedFruit = fruits.value.find(fruit => fruit.id === newId);
    if (selectedFruit) {
      fruitName.value = selectedFruit.name;
      fruitColor.value = selectedFruit.color;
    }
  } else {
    clearFields();
  }
});

onMounted(load);
</script>

<style scoped>
.fruits-container {
  @apply bg-gradient-to-r from-gray-200 to-gray-400;
}

.btn {
  @apply px-4 py-2 rounded;
}

.btn-primary {
  @apply bg-blue-500 text-white;
}

.btn-default {
  @apply bg-gray-300 text-black;
}

.input {
  @apply w-full px-3 py-2 border rounded;
}
</style>